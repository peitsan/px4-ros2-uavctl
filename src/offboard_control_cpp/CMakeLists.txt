cmake_minimum_required(VERSION 3.5)
project(offboard_control_cpp)

# ===============================
# ğŸ”§ åŸºæœ¬é…ç½®
# ===============================
set(CMAKE_CXX_STANDARD 17)
set(CMAKE_CXX_STANDARD_REQUIRED ON)

# ===============================
# ğŸ“¦ æŸ¥æ‰¾ä¾èµ–åŒ…
# ===============================
find_package(ament_cmake REQUIRED)
find_package(rclcpp REQUIRED)
find_package(px4_msgs REQUIRED)

# ===============================
# ğŸ“ å¤´æ–‡ä»¶ç›®å½•
# ===============================
include_directories(
  include
  ${px4_msgs_INCLUDE_DIRS}
)

# ===============================
# ğŸ§± æ„å»ºåº“ (liboffboard_control_lib.so)
# ===============================
add_library(offboard_control_lib
  src/offboard_control_lib/offboard_control.cpp
  src/offboard_control_lib/vehicle.cpp
)

# é“¾æ¥ä¾èµ–åº“
target_link_libraries(offboard_control_lib
  PUBLIC
  rclcpp::rclcpp
  ${px4_msgs_TARGETS}   # æˆ– px4_msgs::px4_msgs
)

# ===============================
# ğŸš€ æ„å»ºä¸»ç¨‹åº (main)
# ===============================
add_executable(offboard_control_main src/main.cpp)

# main é“¾æ¥è‡ªå®šä¹‰åº“
target_link_libraries(offboard_control_main PRIVATE offboard_control_lib)

# ===============================
# ğŸ“¦ å®‰è£…é…ç½®
# ===============================
# å®‰è£…å¯æ‰§è¡Œæ–‡ä»¶ï¼ˆros2 run æ‰¾è¿™ä¸ªï¼‰
install(TARGETS
  offboard_control_main
  DESTINATION lib/${PROJECT_NAME}
)

# å®‰è£…åº“æ–‡ä»¶ï¼ˆä¾›å…¶ä»–åŒ…å¤ç”¨ï¼‰
install(TARGETS
  offboard_control_lib
  DESTINATION lib
)

# å®‰è£…å¤´æ–‡ä»¶
install(DIRECTORY include/
  DESTINATION include/
)

# ===============================
# âœ… ament æ”¶å°¾
# ===============================
ament_package()
